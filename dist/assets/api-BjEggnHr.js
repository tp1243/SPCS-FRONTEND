let c=null;function f(e){const t=e.trim();if(!t)return"";const r=t.replace(/\/$/,"");return r.endsWith("/api")?r:`${r}/api`}async function l(){if(c)return c;const e=typeof window<"u"?(localStorage.getItem("apiResolved")||"").trim():"",t=typeof window<"u"?(localStorage.getItem("apiBaseOverride")||"").trim():"",r="".trim(),s=/smart-police-complaint-system\.onrender\.com/i.test(r),a=h=>/smart-police-complaint-system\.onrender\.com/i.test(h||""),i=a(e)?"":e,u=a(t)?"":t,d=i||""||u||""||(!s&&r?r:typeof window<"u"?window.location.hostname.includes("spcs-frontend.vercel.app")?"https://spcs-backend.onrender.com":window.location.origin:"http://localhost:5175");return c=f(d),typeof window<"u"&&localStorage.setItem("apiResolved",c),c}async function o(e,t){const r=await l(),s={"Content-Type":"application/json",...t.headers||{}},a={...t,headers:s};let i=!0;try{const n=typeof a.body=="string"?a.body:"";n&&n.length>6e4&&(i=!1)}catch{}try{const n=typeof navigator<"u"?navigator.userAgent:"";/Android|iPhone|iPad|iPod|Mobile/i.test(n)&&(i=!1)}catch{}const u=String(a.method||"GET").toUpperCase()==="GET"?25e3:35e3,d=new AbortController,h=setTimeout(()=>d.abort(),u);try{const n=await fetch(`${r}${e}`,{...a,keepalive:i,mode:"cors",cache:"no-store",signal:d.signal});if(clearTimeout(h),!n.ok){const y=await n.json().catch(()=>({}));throw new Error(y.error||`Request failed: ${n.status}`)}return n.json()}catch(n){clearTimeout(h);const y=n?.name==="AbortError"?"Network timeout. Please try again.":n?.message||"Network error";throw new Error(y)}}const m={async register(e,t,r,s){return o("/auth/register",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,phone:s})})},async registerBegin(e,t,r,s){return o("/auth/register/begin",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,phone:s})})},async registerVerify(e,t,r,s,a){return o("/auth/register/verify-otp",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,otp:s,phone:a})})},async policeRegister(e,t,r,s){return o("/police/register",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,station:s})})},async policeLogin(e,t,r){return o("/police/login",{method:"POST",body:JSON.stringify({email:e,password:t,station:r})})},async login(e,t){return o("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})})},async loginBegin(e,t){return o("/auth/login/begin",{method:"POST",body:JSON.stringify({email:e,password:t})})},async loginVerify(e,t){return o("/auth/login/verify-otp",{method:"POST",body:JSON.stringify({email:e,otp:t})})},async otpResend(e,t){return o("/auth/otp/resend",{method:"POST",body:JSON.stringify({email:e,purpose:t})})},async profile(e){return o("/profile",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async updateProfile(e,t){return o("/profile",{method:"PUT",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify(t)})},async changePassword(e,t,r){return o("/auth/change-password",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({currentPassword:t,newPassword:r})})},async deleteAccount(e,t){return o("/profile",{method:"DELETE",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({password:t})})}},p={async faqsList(e,t){const r=new URLSearchParams;return e&&r.set("q",e),t&&r.set("category",t),o(`/faqs?${r.toString()}`,{method:"GET"})},async faqVote(e,t,r){return o(`/faqs/${t}/vote`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({helpful:r})})},async faqVotes(e){return o("/faqs/votes",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async createTicket(e,t){return o("/support-tickets",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify(t)})},async listTickets(e){return o("/support-tickets",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async chatList(e){return o("/chat/messages",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async chatSend(e,t,r=!0){return o("/chat/send",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({message:t,useAI:r})})},async feedbackSubmit(e){return o("/feedback",{method:"POST",body:JSON.stringify(e)})},async feedbackStats(){return o("/feedback/stats",{method:"GET"})},async feedbackList(){return o("/feedback",{method:"GET"})},async supportContact(e){const t=new URLSearchParams;return e&&t.set("city",e),o(`/support/contact?${t.toString()}`,{method:"GET"})}};export{m as a,o as r,p as s};
