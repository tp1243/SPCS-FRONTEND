import{r as i,j as s}from"./charts-FoNSDMOs.js";import{p as c}from"./PoliceDashboard-D-kZkQ1F.js";import"./react-BzrpNAyj.js";import"./pdf-DU8byqIM.js";import"./index-BMC4Z6Sv.js";import"./icons-CvT1UHUk.js";import"./BrandIcon-CHAwuYok.js";import"./api-CQIUfn0V.js";import"./NotificationToast-E-op-oVm.js";import"./index-C2nar-Ha.js";function J({token:n}){const[a,d]=i.useState(null),[v,P]=i.useState([]),[h,o]=i.useState(null),[p,x]=i.useState(!1),[l,m]=i.useState({currentPassword:"",newPassword:"",confirm:""}),[N,j]=i.useState(!1),[g,w]=i.useState(""),[f,b]=i.useState(!1),[y,S]=i.useState(void 0);i.useEffect(()=>{let e=!0;return c.profile(n).then(t=>{e&&d(t)}).catch(t=>o(t.message||"Failed to load profile")),c.listStations(n).then(t=>P(t.stations||[])).catch(()=>{}),()=>{e=!1}},[n]);const r=i.useMemo(()=>a&&v.find(e=>e.name===a.station)||null,[v,a]);async function A(){if(a){x(!0);try{const e={name:a.name,rank:a.rank,phone:a.phone,city:a.city,avatarUrl:y||a.avatarUrl,status:a.status},t=await c.updateProfile(n,e);d(t)}catch(e){o(e.message||"Failed to save")}x(!1)}}async function C(){j(!0);try{if(!l.currentPassword||!l.newPassword||!l.confirm)throw new Error("Fill all fields");if(l.newPassword!==l.confirm)throw new Error("New passwords do not match");await c.changePassword(n,l.currentPassword,l.newPassword),m({currentPassword:"",newPassword:"",confirm:""})}catch(e){o(e.message||"Failed to change password")}j(!1)}async function F(e){try{const t=await c.enable2FA(n,e);d(u=>u&&{...u,twoFactorEnabled:t.twoFactorEnabled})}catch(t){o(t.message||"Failed to update 2FA")}}async function L(){try{await c.logoutAll(n)}catch(e){o(e.message||"Failed to logout all")}}async function U(){if(a){b(!0);try{await c.requestStationUpdate(n,{stationName:a.station,message:g}),w("")}catch(e){o(e.message||"Failed to request update")}b(!1)}}function E(e){if(!e)return;const t=new FileReader;t.onload=()=>S(String(t.result)),t.readAsDataURL(e)}return s.jsxs("div",{className:"panel",children:[s.jsx("div",{className:"label",children:"Settings & Profile"}),h&&s.jsx("div",{className:"form-error",children:h}),a?s.jsxs("div",{className:"settings-grid",children:[s.jsxs("section",{className:"settings-section",children:[s.jsxs("div",{className:"settings-header",children:["Officer Information ",s.jsx("span",{className:"badge-icon",children:"ðŸŽ–ï¸"})]}),s.jsxs("div",{className:"settings-card",children:[s.jsxs("div",{className:"avatar-wrapper",children:[s.jsx("img",{className:"avatar",src:y||a.avatarUrl||"https://via.placeholder.com/64",alt:"avatar"}),s.jsxs("label",{className:"btn ghost",children:["Upload New Profile Picture",s.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:e=>E(e.target.files?.[0])})]})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Name"}),s.jsx("input",{className:"input",value:a.name||"",onChange:e=>d({...a,name:e.target.value})}),s.jsx("div",{className:"muted-small"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Rank"}),s.jsx("input",{className:"input",value:a.rank||"",onChange:e=>d({...a,rank:e.target.value})}),s.jsx("div",{className:"muted-small"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Email"}),s.jsx("input",{className:"input",value:a.email,readOnly:!0}),s.jsx("div",{className:"muted-small",children:"non-editable"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Contact"}),s.jsx("input",{className:"input",value:a.phone||"",onChange:e=>d({...a,phone:e.target.value})}),s.jsx("div",{className:"muted-small"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Assigned Station"}),s.jsx("input",{className:"input",value:a.station,readOnly:!0}),s.jsx("div",{className:"muted-small",children:"view only"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"City"}),s.jsx("input",{className:"input",value:a.city||"Navi Mumbai",onChange:e=>d({...a,city:e.target.value})}),s.jsx("div",{className:"muted-small"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Last Login"}),s.jsx("input",{className:"input",value:a.lastLoginAt?new Date(a.lastLoginAt).toLocaleString():"â€”",readOnly:!0}),s.jsx("div",{className:"muted-small"})]}),s.jsx("div",{className:"btn-group",children:s.jsx("button",{className:"btn",onClick:A,disabled:p,children:p?"Savingâ€¦":"Save Changes"})})]})]}),s.jsxs("section",{className:"settings-section",children:[s.jsx("div",{className:"settings-header",children:"Station Information"}),s.jsxs("div",{className:"settings-card",children:[s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Station Name"}),s.jsx("input",{className:"input",value:r?.name||a.station,readOnly:!0}),s.jsx("div",{className:"muted-small"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Address"}),s.jsx("input",{className:"input",value:r?.address||"N/A",readOnly:!0}),s.jsx("div",{className:"muted-small"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"City"}),s.jsx("input",{className:"input",value:a.city||"Navi Mumbai",readOnly:!0}),s.jsx("div",{className:"muted-small"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Jurisdiction Area"}),s.jsx("input",{className:"input",value:r?.zone||r?.division||"Navi Mumbai",readOnly:!0}),s.jsx("div",{className:"muted-small"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Station Contact"}),s.jsx("input",{className:"input",value:"N/A",readOnly:!0}),s.jsx("div",{className:"muted-small"})]}),s.jsx("div",{className:"map-wrapper",children:r?.lat&&r?.lng?s.jsx("iframe",{title:"station-map",src:`https://maps.google.com/maps?q=${r.lat},${r.lng}&z=15&output=embed`}):s.jsx("div",{className:"muted",children:"Map unavailable"})}),s.jsx("textarea",{className:"input",placeholder:"Add note for update request (optional)",value:g,onChange:e=>w(e.target.value)}),s.jsx("div",{className:"btn-group",children:s.jsx("button",{className:"btn ghost",onClick:U,disabled:f,children:f?"Requestingâ€¦":"Request Update"})})]})]}),s.jsxs("section",{className:"settings-section",children:[s.jsx("div",{className:"settings-header",children:"Security & Password"}),s.jsxs("div",{className:"settings-card",children:[s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Current Password"}),s.jsx("input",{className:"input",type:"password",value:l.currentPassword,onChange:e=>m({...l,currentPassword:e.target.value})}),s.jsx("div",{className:"muted-small"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"New Password"}),s.jsx("input",{className:"input",type:"password",value:l.newPassword,onChange:e=>m({...l,newPassword:e.target.value})}),s.jsx("div",{className:"muted-small"})]}),s.jsxs("div",{className:"field-row",children:[s.jsx("div",{className:"label",children:"Confirm New"}),s.jsx("input",{className:"input",type:"password",value:l.confirm,onChange:e=>m({...l,confirm:e.target.value})}),s.jsx("div",{className:"muted-small"})]}),s.jsxs("div",{className:"btn-group",children:[s.jsx("button",{className:"btn",onClick:C,disabled:N,children:N?"Updatingâ€¦":"Change Password"}),s.jsx("button",{className:"btn ghost",onClick:()=>F(!a.twoFactorEnabled),children:a.twoFactorEnabled?"Disable 2FA":"Enable 2FA"}),s.jsx("button",{className:"btn danger ghost",onClick:L,children:"Logout of all devices"})]}),s.jsx("div",{className:"divider"}),s.jsxs("div",{className:"history-list",children:[s.jsx("div",{className:"muted-small",children:"Last Login Details & Devices"}),s.jsxs("div",{className:"history-item",children:[s.jsx("span",{children:a.lastLoginAt?new Date(a.lastLoginAt).toLocaleString():"â€”"}),s.jsxs("span",{children:["â€¢ ",a.lastLoginIp||"â€”"]}),s.jsxs("span",{children:["â€¢ ",a.lastLoginAgent||"â€”"]})]}),(a.loginHistory||[]).slice(-5).reverse().map((e,t)=>s.jsxs("div",{className:"history-item",children:[s.jsx("span",{children:e.at?new Date(e.at).toLocaleString():"â€”"}),s.jsxs("span",{children:["â€¢ ",e.ip||"â€”"]}),s.jsxs("span",{children:["â€¢ ",e.userAgent||"â€”"]})]},t))]})]})]})]}):s.jsx("div",{className:"muted",children:"Loading profileâ€¦"})]})}export{J as default};
