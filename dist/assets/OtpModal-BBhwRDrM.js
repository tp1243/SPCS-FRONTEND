import{r as s,j as e}from"./charts-FoNSDMOs.js";import{v as U,w as K,x as _}from"./index-D8KJrxB-.js";import{B as W}from"./BrandIcon-CHAwuYok.js";import{L as A}from"./index-BW3I4jBn.js";import{E as X,b as Y,G as q,y as z}from"./index-BMC4Z6Sv.js";import{a as j}from"./api-Cc3zVDBP.js";import{A as J,m as d}from"./motion-B__JDtHc.js";function L(){try{const r=typeof window<"u"?(localStorage.getItem("apiResolved")||localStorage.getItem("apiBaseOverride")||"").trim():"",l="".trim(),o=u=>/smart-police-complaint-system\.onrender\.com/i.test(u||""),n=o(r)?"":r,c=o(l)?"":l;let a=n||c||(typeof window<"u"?window.location.hostname.includes("spcs-frontend.vercel.app")?"https://spcs-backend.onrender.com/api":`${window.location.origin}/api`:"/api");return a=a.replace(/\/$/,""),a.endsWith("/api")?a:`${a}/api`}catch{return"/api"}}function ne(){const[r,l]=s.useState({google:!0,github:!0,apple:!1}),[o,n]=s.useState(!0);s.useEffect(()=>{(async()=>{n(!0);try{const p=L(),a=await fetch(`${p}/oauth/providers`).then(u=>u.json());l({google:!!a.google,github:!!a.github,apple:!!a.apple})}catch{l({google:!1,github:!1,apple:!1})}finally{n(!1)}})()},[]);const c=p=>{const a=L();window.location.href=`${a}/auth/${p}`};return e.jsxs("div",{className:"social-auth",children:[e.jsx("div",{className:"divider",children:e.jsx("span",{children:"OR"})}),e.jsxs("div",{className:`social-buttons ${o?"loading":""}`,children:[e.jsxs("button",{className:"btn social google","aria-label":"Continue with Google","data-provider":"google",disabled:!r.google,onClick:()=>c("google"),children:[e.jsx(U,{})," ",e.jsx("span",{className:"provider-label",children:"Continue with Google"})]}),e.jsxs("button",{className:"btn social github","aria-label":"Continue with GitHub","data-provider":"github",disabled:!r.github,onClick:()=>c("github"),children:[e.jsx(K,{})," ",e.jsx("span",{className:"provider-label",children:"Continue with GitHub"})]}),e.jsxs("button",{className:"btn social apple","aria-label":"Continue with Apple","data-provider":"apple",disabled:!r.apple,onClick:()=>c("apple"),title:r.apple?"":"Apple Sign In not configured",children:[e.jsx(_,{})," ",e.jsx("span",{className:"provider-label",children:"Continue with Apple"})]})]})]})}function re({variant:r}){const[l,o]=s.useState(!1);s.useEffect(()=>{const c=()=>o(window.scrollY>8);return c(),window.addEventListener("scroll",c),()=>window.removeEventListener("scroll",c)},[]);const n=r==="login";return e.jsx("header",{className:`auth-navbar ${l?"scrolled":""}`,children:e.jsxs("div",{className:"auth-nav-inner",children:[e.jsxs(A,{to:"/",className:"logo","aria-label":"Smart Police Complaint System (SPCS)",children:[e.jsx(W,{height:26,className:"logo-icon",title:"SPCS logo"}),e.jsx("span",{className:"logo-text",children:"SPCS"})]}),e.jsx("div",{className:"auth-nav-actions",children:n?e.jsx(A,{className:"btn primary",to:"/register",children:"Register"}):e.jsx(A,{className:"btn ghost",to:"/login",children:"Login"})})]})})}function le({open:r,purpose:l,email:o,beginPayload:n,onClose:c,onSuccess:p}){const[a,u]=s.useState(""),[N,f]=s.useState(!1),[T,h]=s.useState(""),[v,C]=s.useState(0),[k,I]=s.useState(300),b=s.useRef(null),m=s.useRef(null),[S,R]=s.useState(["","","","","",""]),x=s.useRef([]);s.useEffect(()=>{if(r)return h(""),u(""),C(0),I(300),R(["","","","","",""]),(async()=>{try{f(!0),l==="register"?await j.registerBegin(String(n?.username||""),o,String(n?.password||""),n?.phone):await j.loginBegin(o,String(n?.password||"")),O()}catch(t){h(t?.message||"Failed to send OTP")}finally{f(!1)}})(),()=>{b.current&&window.clearInterval(b.current),m.current&&window.clearInterval(m.current)}},[r]);function O(){b.current&&window.clearInterval(b.current),m.current&&window.clearInterval(m.current),I(300),b.current=window.setInterval(()=>{I(t=>t>0?t-1:0)},1e3)}function D(t,i){const y=i.replace(/\D/g,"").slice(0,1),g=[...S];g[t]=y,R(g);const E=g.join("");u(E),y&&t<5&&x.current[t+1]?.focus()}function $(t,i){i.key==="Backspace"&&!S[t]&&t>0&&x.current[t-1]?.focus(),i.key==="ArrowLeft"&&t>0&&(i.preventDefault(),x.current[t-1]?.focus()),i.key==="ArrowRight"&&t<5&&(i.preventDefault(),x.current[t+1]?.focus()),i.key==="Enter"&&P()}function M(t,i){const y=i.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(!y)return;i.preventDefault();const g=[...S];for(let w=0;w<6&&t+w<6;w++)g[t+w]=y[w]||"";R(g);const E=g.join("");u(E);const H=Math.min(5,t+y.length);x.current[H]?.focus()}async function P(){if(h(""),!a||a.trim().length!==6){h("Enter the 6-digit OTP");return}try{if(f(!0),l==="register"){const t=await j.registerVerify(String(n?.username||""),o,String(n?.password||""),a.trim(),n?.phone);p(t)}else{const t=await j.loginVerify(o,a.trim());p(t)}}catch(t){h(t?.message||"Invalid OTP")}finally{f(!1)}}async function B(){if(h(""),!(v>0))try{f(!0),await j.otpResend(o,l),C(60),m.current&&window.clearInterval(m.current),m.current=window.setInterval(()=>{C(t=>t>0?t-1:0)},1e3),O()}catch(t){h(t?.message||"Failed to resend OTP")}finally{f(!1)}}const F=l==="register"?"Verify your email":"Verify login",G=l==="register"?"Enter the 6-digit OTP sent to your email":"Enter the 6-digit OTP sent to your registered email",V=Math.max(0,Math.min(100,Math.floor(k/300*100)));return e.jsx(J,{children:r&&e.jsx(d.div,{className:"biometric-modal",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{backdropFilter:"blur(8px)",background:"radial-gradient(1200px 600px at 20% -10%, rgba(32,99,248,0.18), transparent), radial-gradient(1200px 600px at 120% 110%, rgba(255,129,64,0.18), transparent)"},children:e.jsxs(d.div,{className:"biometric-card",initial:{opacity:0,y:22,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.98},transition:{type:"spring",stiffness:260,damping:24},style:{boxShadow:"0 12px 40px rgba(0,0,0,0.2)",borderRadius:16,overflow:"hidden",border:"1px solid rgba(255,255,255,0.08)",background:"linear-gradient(180deg, rgba(20,22,26,0.9), rgba(20,22,26,0.85))"},children:[e.jsxs("div",{className:"biometric-header",children:[e.jsxs(d.div,{className:"brand-mini",initial:{opacity:0,x:-6},animate:{opacity:1,x:0},transition:{delay:.05},children:[e.jsx(d.div,{initial:{rotate:-8,scale:.9},animate:{rotate:0,scale:1},transition:{type:"spring",stiffness:320,damping:18},style:{display:"grid",placeItems:"center"},children:e.jsx(X,{})}),e.jsxs("div",{children:[e.jsx("div",{className:"brand-title",children:"SPCS"}),e.jsx("div",{className:"brand-sub",children:"Smart Police Complaint System"})]})]}),e.jsx("button",{className:"close-btn",onClick:c,"aria-label":"Close",children:e.jsx(Y,{})})]}),e.jsxs("div",{className:"biometric-body",children:[e.jsx("div",{className:"scan-left",children:e.jsxs(d.div,{className:"otp-card",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.08},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(q,{}),e.jsx("h4",{style:{margin:0},children:F})]}),e.jsx("div",{className:"muted",children:G}),e.jsx("div",{className:"otp-grid",style:{marginTop:14},children:[0,1,2,3,4,5].map(t=>e.jsx(d.input,{ref:i=>{x.current[t]=i},className:"otp-cell",inputMode:"numeric",maxLength:1,value:S[t],onChange:i=>D(t,i.target.value),onKeyDown:i=>$(t,i),onPaste:i=>M(t,i),whileFocus:{scale:1.04,boxShadow:"0 0 0 3px rgba(99,102,241,0.35)"},transition:{type:"spring",stiffness:380,damping:22}},t))}),T&&e.jsx("div",{className:"form-error small",children:T}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:12},children:[e.jsx(d.button,{className:"btn primary",onClick:P,disabled:N||k===0,whileTap:{scale:.98},children:N?"Verifying...":"Verify"}),e.jsxs(d.button,{className:"btn ghost",onClick:B,disabled:N||v>0,whileTap:{scale:.98},children:["Resend ",v>0?`(${v}s)`:""]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:10},children:[e.jsx(z,{})," Expires in ",Math.max(0,k),"s"]}),e.jsx("div",{style:{marginTop:8,width:"100%",height:6,background:"rgba(255,255,255,0.08)",borderRadius:999},children:e.jsx(d.div,{style:{height:6,borderRadius:999,background:"linear-gradient(90deg, #6366F1, #22D3EE)"},initial:{width:"100%"},animate:{width:`${V}%`},transition:{ease:"easeOut",duration:.25}})})]})}),e.jsxs("div",{className:"scan-right",children:[e.jsx(d.h3,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:.12},children:F}),e.jsx(d.p,{className:"muted",initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:.18},children:"One-time password verification with secure delivery"}),e.jsxs("ul",{className:"scan-steps",children:[e.jsx("li",{children:"Check inbox"}),e.jsx("li",{children:"Enter OTP"}),e.jsx("li",{children:"Complete verification"})]}),e.jsx("div",{className:"actions",children:e.jsx(d.button,{className:"btn ghost",onClick:c,whileTap:{scale:.98},children:"Cancel"})})]})]})]})})})}export{re as A,le as O,ne as S};
