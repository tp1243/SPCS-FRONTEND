import{r as h,j as e,B as rt,L as dt,C as ct,a as gt,b as ht,P as mt,c as ft,d as ut,p as pt,e as bt}from"./charts-FoNSDMOs.js";import{p as _}from"./PoliceDashboard-D-kZkQ1F.js";import"./react-BzrpNAyj.js";import"./pdf-DU8byqIM.js";import"./index-BMC4Z6Sv.js";import"./icons-CvT1UHUk.js";import"./BrandIcon-CHAwuYok.js";import"./api-CQIUfn0V.js";import"./NotificationToast-E-op-oVm.js";import"./index-C2nar-Ha.js";ct.register(gt,ht,mt,ft,ut,pt,bt);function Nt({token:T,station:X}){const[Q,K]=h.useState({labels:["Pending","In Progress","Solved"],datasets:[{label:"Complaints",backgroundColor:"#38bdf8",data:[0,0,0]}]}),[tt,et]=h.useState({labels:[],datasets:[{label:"Trend",borderColor:"#60a5fa",backgroundColor:"rgba(96,165,250,0.2)",data:[]}]}),[st,at]=h.useState(0),[nt,ot]=h.useState(0),[C,it]=h.useState([]),[S,G]=h.useState(null),[U,V]=h.useState(12),[k,lt]=h.useState(null),[B,q]=h.useState(null);return h.useEffect(()=>{let a=!0;function n(i){const d=X?i.filter(t=>(t.station||"").trim()===X):i,L=d.filter(t=>(t.status||"")==="Solved").length,f=d.filter(t=>(t.status||"")==="Pending").length,y=d.filter(t=>["In Progress","Under Review"].includes(t.status||"")).length;K({labels:["Pending","In Progress","Solved","FIR","Non-FIR"],datasets:[{label:"Distribution",data:[f,y,L,0,0],backgroundColor:["#38bdf8","#38bdf8","#38bdf8","rgba(239,68,68,0.35)","rgba(16,185,129,0.35)"],borderColor:["#38bdf8","#38bdf8","#38bdf8","#ef4444","#10b981"],borderWidth:1}]});const E=[...Array(7)].map((t,l)=>{const r=new Date;return r.setDate(r.getDate()-(6-l)),r}),W=E.map(t=>t.toLocaleDateString(void 0,{weekday:"short"})),H=E.map(t=>{const l=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime();return d.filter(r=>{const p=new Date(r.createdAt||r.updatedAt||Date.now());return new Date(p.getFullYear(),p.getMonth(),p.getDate()).getTime()===l}).length});et({labels:W,datasets:[{label:"Trend",borderColor:"#60a5fa",backgroundColor:"rgba(96,165,250,0.2)",data:H}]});const D=d.filter(t=>String(t.category||"").trim().toLowerCase()==="fir").length,z=d.filter(t=>String(t.category||"").trim().toLowerCase()==="non-fir").length;at(D),ot(z),K(t=>({labels:["Pending","In Progress","Solved","FIR","Non-FIR"],datasets:[{...t.datasets?.[0],label:"Distribution",data:[f,y,L,D,z],backgroundColor:["#38bdf8","#38bdf8","#38bdf8","rgba(239,68,68,0.35)","rgba(16,185,129,0.35)"],borderColor:["#38bdf8","#38bdf8","#38bdf8","#ef4444","#10b981"],borderWidth:1}]}));const u=d.map(t=>t.location||{}).filter(t=>typeof t.lat=="number"&&typeof t.lng=="number");if(it(u),u.length>0){let t=u[0].lat,l=u[0].lat,r=u[0].lng,p=u[0].lng;for(const c of u)c.lat<t&&(t=c.lat),c.lat>l&&(l=c.lat),c.lng<r&&(r=c.lng),c.lng>p&&(p=c.lng);G({minLat:t,maxLat:l,minLng:r,maxLng:p});const Y=(t+l)/2,O=(r+p)/2;lt({lat:Y,lng:O})}else G(null)}_.listComplaints(T,{fields:"summary",limit:200}).then(i=>{a&&n(i.complaints||[])}).catch(()=>{});const R=setInterval(()=>{_.listComplaints(T,{fields:"summary",limit:200}).then(i=>n(i.complaints||[])).catch(()=>{})},12e3),m=()=>{_.listComplaints(T,{fields:"summary",limit:200}).then(i=>n(i.complaints||[])).catch(()=>{})};return window.addEventListener("spcs:complaint-status-updated",m),()=>{a=!1,clearInterval(R),window.removeEventListener("spcs:complaint-status-updated",m)}},[T,X]),h.useEffect(()=>{const a=document.getElementById("heat-canvas");if(!a)return;const n=a.getContext("2d");if(!n)return;const R=a.getBoundingClientRect(),m=typeof window<"u"&&window.devicePixelRatio||1;a.width=Math.max(600,Math.floor(R.width*m)),a.height=Math.max(260,Math.floor(R.height*m)),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,a.width,a.height),m>1&&n.scale(m,m);const i=R.width,d=R.height,L=U,f=256;function y(o){return o*Math.PI/180}const E=k?k.lat:S?(S.minLat+S.maxLat)/2:19.033,W=k?k.lng:S?(S.minLng+S.maxLng)/2:73.029,H=f*Math.pow(2,L);function D(o,M){const b=(M+180)/360*H,F=(1-Math.log(Math.tan(y(o))+1/Math.cos(y(o)))/Math.PI)/2*H;return{x:b,y:F}}function z(o){return o<=.33?`rgba(34,197,94,${.35+o*.4})`:o<=.66?`rgba(234,179,8,${.45+(o-.33)*.4})`:`rgba(239,68,68,${.55+(o-.66)*.4})`}const u=D(E,W),t=u.x-i/2,l=u.y-d/2,r=Math.floor(t/f),p=Math.floor(l/f),Y=Math.floor((t+i)/f),O=Math.floor((l+d)/f),c=[],J=[];for(let o=r;o<=Y;o++)for(let M=p;M<=O;M++){const b=new Image;b.crossOrigin="anonymous",b.src=`https://tile.openstreetmap.org/${L}/${o}/${M}.png`;const F=o*f-t,A=M*f-l;c.push({img:b,x:F,y:A}),J.push(new Promise(s=>{b.onload=()=>s(),b.onerror=()=>s()}))}Promise.all(J).then(()=>{for(const s of c)n.drawImage(s.img,s.x,s.y,256,256);if(!C||C.length===0)return;function o(s,v,g,j){const x=y(g-s),P=y(j-v),w=Math.sin(x/2)**2+Math.cos(y(s))*Math.cos(y(g))*Math.sin(P/2)**2;return 6371*(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)))}const M=.8*(12/L),b=C.map(s=>{let v=0;for(const g of C)o(s.lat,s.lng,g.lat,g.lng)<=M&&v++;return v}),F=Math.max(1,...b),A=[];n.globalCompositeOperation="lighter";for(let s=0;s<C.length;s++){const v=C[s],g=D(v.lat,v.lng),j=g.x-t,I=g.y-l,x=b[s],P=Math.min(1,x/F),w=Math.max(26,Math.min(Math.max(i,d)*.06,42))*(12/L),N=n.createRadialGradient(j,I,0,j,I,w),$=z(P);N.addColorStop(0,$),N.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=N,n.shadowColor="rgba(0,0,0,0.35)",n.shadowBlur=12,n.beginPath(),n.arc(j,I,w,0,Math.PI*2),n.fill(),A.push({x:j,y:I,val:x})}a.onmousemove=s=>{const v=Math.max(24,Math.min(Math.max(i,d)*.05,36)),g=a.getBoundingClientRect(),j=(s.clientX-g.left)*(m>1,1),I=(s.clientY-g.top)*(m>1,1);let x=null,P=1/0;for(const w of A){const N=w.x-j,$=w.y-I,Z=Math.sqrt(N*N+$*$);Z<v&&Z<P&&(P=Z,x=w)}q(x?{x:x.x,y:x.y,count:x.val}:null)},a.onmouseleave=()=>q(null)})},[C,S,U,k]),e.jsxs("div",{className:"panel",children:[e.jsxs("div",{className:"grid two",style:{alignItems:"stretch"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateRows:"1fr 1fr",gap:12},children:[e.jsxs("div",{className:"card",style:{background:"linear-gradient(135deg,#1f2937 0%,#111827 100%)",border:"1px solid #374151",minHeight:100},children:[e.jsxs("div",{className:"label",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{width:10,height:10,borderRadius:999,background:"#ef4444",display:"inline-block"}}),"FIR"]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:6},children:[e.jsx("div",{style:{fontSize:36,fontWeight:700,color:"#ef4444"},children:st}),e.jsx("div",{className:"muted",children:"cases"})]})]}),e.jsxs("div",{className:"card",style:{background:"linear-gradient(135deg,#1f2937 0%,#0b3a2a 100%)",border:"1px solid #1e3a2f",minHeight:100},children:[e.jsxs("div",{className:"label",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{width:10,height:10,borderRadius:999,background:"#10b981",display:"inline-block"}}),"Non-FIR"]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:6},children:[e.jsx("div",{style:{fontSize:36,fontWeight:700,color:"#10b981"},children:nt}),e.jsx("div",{className:"muted",children:"cases"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"label",children:"Heat Map"}),e.jsxs("div",{style:{position:"relative",width:"100%",minHeight:220,borderRadius:10,overflow:"hidden",background:"#0b1220",border:"1px solid #1f2a44"},children:[e.jsx("canvas",{id:"heat-canvas",width:600,height:260,style:{width:"100%",height:220,display:"block"}}),e.jsxs("div",{style:{position:"absolute",top:8,right:8,display:"flex",gap:8},children:[e.jsx("button",{className:"btn sm",onClick:()=>V(a=>Math.min(15,a+1)),children:"+"}),e.jsx("button",{className:"btn sm",onClick:()=>V(a=>Math.max(10,a-1)),children:"âˆ’"})]}),e.jsxs("div",{style:{position:"absolute",bottom:8,left:8,display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:140,height:10,borderRadius:999,background:"linear-gradient(90deg, rgba(34,197,94,0.7), rgba(234,179,8,0.7), rgba(239,68,68,0.7))"}}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"Low"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"High"})]}),B&&e.jsxs("div",{style:{position:"absolute",left:B.x,top:B.y,transform:"translate(-50%, -120%)",background:"var(--surface)",border:"1px solid var(--border)",borderRadius:10,padding:"6px 8px",color:"var(--text)",fontSize:12,boxShadow:"0 6px 18px rgba(0,0,0,0.35)"},children:["Intensity: ",B.count]})]})]})]}),e.jsxs("div",{className:"grid two",style:{marginTop:16},children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"label",children:"Distribution"}),e.jsx(rt,{data:Q,options:{plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"label",children:"Real-time Trend"}),e.jsx(dt,{data:tt,options:{plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})]})]})]})}export{Nt as default};
