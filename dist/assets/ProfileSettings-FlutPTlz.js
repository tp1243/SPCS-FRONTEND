import{r as d,j as e}from"./charts-FoNSDMOs.js";import{a as f}from"./api-Cc3zVDBP.js";import"./react-BzrpNAyj.js";const v=({onEdit:r,notify:l})=>{const[a,s]=d.useState(null);d.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("token");if(t){const i=await f.profile(t);s(i.user)}}catch(t){console.error("Failed to fetch profile:",t)}})()},[]);const n=async o=>{const t=o.target.files?.[0];if(!t)return;const i=new FileReader;i.onload=async()=>{try{const m=localStorage.getItem("token")||"",u=String(i.result),x=await f.updateProfile(m,{avatarUrl:u});s(x.user),l("Avatar updated successfully","success")}catch(m){console.error("Avatar update failed",m),l("Failed to update avatar","error")}},i.readAsDataURL(t)};return a?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Profile Overview"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"avatar-upload",children:[e.jsx("div",{className:"avatar-preview",children:e.jsx("div",{id:"imagePreview",style:{backgroundImage:`url(${a.avatarUrl||"http://i.pravatar.cc/500?img=7"})`}})}),e.jsxs("div",{className:"avatar-edit",children:[e.jsx("input",{type:"file",id:"imageUpload",accept:".png, .jpg, .jpeg",onChange:n}),e.jsx("label",{htmlFor:"imageUpload"})]})]}),e.jsxs("div",{className:"user-info",children:[e.jsx("h4",{children:a.username}),e.jsx("p",{children:a.email}),a.phone&&e.jsx("p",{children:a.phone}),a.address&&e.jsx("p",{children:a.address})]}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn primary",onClick:r,children:"Edit Profile"}),e.jsx("button",{className:"btn ghost",onClick:()=>window.scrollTo({top:9999,behavior:"smooth"}),children:"Change Password"})]})]})]}):e.jsx("div",{children:"Loading..."})},N=({editing:r,onDone:l,notify:a})=>{const[s,n]=d.useState({}),[o,t]=d.useState({}),[i,m]=d.useState(!1);d.useEffect(()=>{(async()=>{try{const h=localStorage.getItem("token");if(h){const j=await f.profile(h);n(j.user)}}catch(h){console.error("Failed to fetch profile:",h)}})()},[]);const u=c=>{const{name:h,value:j}=c.target;n({...s,[h]:j})},x=()=>{const c={};return(!s.username||s.username.trim().length===0)&&(c.username="Username is required"),(!s.email||s.email.trim().length===0)&&(c.email="Email is required"),s.phone&&!/^\+?[0-9]{7,15}$/.test(s.phone)&&(c.phone="Invalid phone number"),t(c),Object.keys(c).length===0},g=async()=>{if(x()){m(!0);try{const c=localStorage.getItem("token");if(c){const h=await f.updateProfile(c,{username:s.username,email:s.email,phone:s.phone,address:s.address});n(h.user),a("Profile changes saved","success"),l()}}catch(c){console.error("Failed to update profile:",c),a(c.message||"Failed to update profile","error")}finally{m(!1)}}},p=()=>{(async()=>{try{const h=localStorage.getItem("token");if(h){const j=await f.profile(h);n(j.user)}}catch(h){console.error("Failed to fetch profile:",h)}})(),l()};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Personal Information"})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{children:[e.jsxs("div",{className:"form-row",children:[e.jsx("input",{id:"pi-username",type:"text",name:"username",value:s.username||"",onChange:u,readOnly:!r,placeholder:"Enter username"}),e.jsx("label",{htmlFor:"pi-username",children:"Username"}),o.username&&e.jsx("small",{className:"error-text",children:o.username})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{id:"pi-email",type:"email",name:"email",value:s.email||"",onChange:u,readOnly:!r,placeholder:"Enter email"}),e.jsx("label",{htmlFor:"pi-email",children:"Email"}),o.email&&e.jsx("small",{className:"error-text",children:o.email})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{id:"pi-phone",type:"text",name:"phone",value:s.phone||"",onChange:u,readOnly:!r,placeholder:""}),e.jsx("label",{htmlFor:"pi-phone",children:"Phone"}),o.phone&&e.jsx("small",{className:"error-text",children:o.phone})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{id:"pi-address",type:"text",name:"address",value:s.address||"",onChange:u,readOnly:!r,placeholder:""}),e.jsx("label",{htmlFor:"pi-address",children:"Address"})]}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{type:"button",className:"btn primary",onClick:g,disabled:i||!r,children:i?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",className:"btn ghost",onClick:p,children:"Cancel"})]})]})})]})},w=({notify:r})=>{const[l,a]=d.useState(""),[s,n]=d.useState(""),[o,t]=d.useState(""),[i,m]=d.useState(""),[u,x]=d.useState(""),g=async p=>{if(p.preventDefault(),m(""),x(""),s!==o){m("New passwords do not match");return}try{const c=localStorage.getItem("token")||"";await f.changePassword(c,l,s),x("Password changed successfully"),r("Password changed successfully","success"),a(""),n(""),t("")}catch(c){const h=c.message||"Failed to change password";m(h),r(h,"error")}};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Account Security"})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:g,children:[i&&e.jsx("div",{className:"alert alert-danger",children:i}),u&&e.jsx("div",{className:"alert alert-success",children:u}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{id:"as-current",type:"password",value:l,onChange:p=>a(p.target.value),placeholder:""}),e.jsx("label",{htmlFor:"as-current",children:"Current Password"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{id:"as-new",type:"password",value:s,onChange:p=>n(p.target.value),placeholder:""}),e.jsx("label",{htmlFor:"as-new",children:"New Password"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{id:"as-confirm",type:"password",value:o,onChange:p=>t(p.target.value),placeholder:""}),e.jsx("label",{htmlFor:"as-confirm",children:"Confirm New Password"})]}),e.jsx("div",{className:"actions",children:e.jsx("button",{type:"submit",className:"btn primary",children:"Change Password"})})]})})]})},y=()=>{const[r,l]=d.useState({theme:"Light",language:"English",notifications:{email:!0,push:!1,sms:!1}});d.useEffect(()=>{const s=localStorage.getItem("user-preferences");s&&l(JSON.parse(s))},[]);const a=s=>{const{name:n,value:o}=s.target;if(n in r.notifications){const t=s.target.checked,i={...r.notifications,[n]:t},m={...r,notifications:i};l(m),localStorage.setItem("user-preferences",JSON.stringify(m))}else{const t={...r,[n]:o};l(t),localStorage.setItem("user-preferences",JSON.stringify(t))}};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Preferences"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{}),e.jsxs("select",{name:"theme",value:r.theme,onChange:a,children:[e.jsx("option",{children:"Light"}),e.jsx("option",{children:"Dark"}),e.jsx("option",{children:"Auto"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{}),e.jsxs("select",{name:"language",value:r.language,onChange:a,children:[e.jsx("option",{children:"English"}),e.jsx("option",{children:"Hindi"}),e.jsx("option",{children:"Marathi"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"Notification Preferences"}),e.jsxs("div",{children:[e.jsx("input",{type:"checkbox",id:"emailAlerts",name:"email",checked:r.notifications.email,onChange:a}),e.jsx("label",{htmlFor:"emailAlerts",children:"Email Alerts"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"checkbox",id:"pushNotifications",name:"push",checked:r.notifications.push,onChange:a}),e.jsx("label",{htmlFor:"pushNotifications",children:"Push Notifications"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"checkbox",id:"smsAlerts",name:"sms",checked:r.notifications.sms,onChange:a}),e.jsx("label",{htmlFor:"smsAlerts",children:"SMS Alerts"})]})]})]})]})},b=({notify:r})=>{const[l,a]=d.useState(""),[s,n]=d.useState(""),o=async()=>{if(window.confirm("Are you sure you want to delete your account? This action cannot be undone."))try{const t=localStorage.getItem("token")||"";await f.deleteAccount(t,l),r("Account deleted successfully","success"),localStorage.removeItem("token"),setTimeout(()=>{window.location.href="/"},800)}catch(t){const i=t.message||"Failed to delete account";n(i),r(i,"error")}};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Delete Account"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("p",{children:"Once you delete your account, there is no going back. Please be certain."}),s&&e.jsx("div",{className:"alert alert-danger",children:s}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{id:"da-password",type:"password",value:l,onChange:t=>a(t.target.value),placeholder:""}),e.jsx("label",{htmlFor:"da-password",children:"Re-enter Password to Confirm"})]}),e.jsx("div",{className:"actions",children:e.jsx("button",{className:"btn accent",onClick:o,children:"Delete Account"})})]})]})},k=()=>{const[r,l]=d.useState(!1),[a,s]=d.useState({message:"",type:"success",visible:!1}),n=(o,t="info")=>{s({message:o,type:t,visible:!0}),setTimeout(()=>s(i=>({...i,visible:!1})),2500)};return d.useEffect(()=>()=>l(!1),[]),e.jsxs("div",{className:"profile-settings",children:[e.jsx("h2",{className:"card-title",children:"Profile Settings"}),e.jsxs("div",{className:"profile-grid",children:[e.jsx(v,{onEdit:()=>l(!0),notify:n}),e.jsx(N,{editing:r,onDone:()=>l(!1),notify:n})]}),e.jsx(w,{notify:n}),e.jsx(y,{}),e.jsx(b,{notify:n}),a.visible&&e.jsx("div",{className:`toast ${a.type}`,role:"status","aria-live":"polite",children:a.message})]})};export{k as default};
