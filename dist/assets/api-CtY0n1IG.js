let i=null;function f(e){const t=e.trim();if(!t)return"";const r=t.replace(/\/$/,"");return r.endsWith("/api")?r:`${r}/api`}async function p(){if(i)return i;const e=typeof window<"u"?(localStorage.getItem("apiResolved")||"").trim():"",t=typeof window<"u"?(localStorage.getItem("apiBaseOverride")||"").trim():"",r="".trim(),n=/smart-police-complaint-system\.onrender\.com/i.test(r),a=h=>/smart-police-complaint-system\.onrender\.com/i.test(h||""),c=a(e)?"":e,u=a(t)?"":t,d=c||""||u||""||(!n&&r?r:typeof window<"u"?window.location.hostname.includes("spcs-frontend.vercel.app")?"https://spcs-backend.vercel.app":window.location.origin:"http://localhost:5175");return i=f(d),typeof window<"u"&&localStorage.setItem("apiResolved",i),i}async function o(e,t){const r=await p(),n={"Content-Type":"application/json",...t.headers||{}},a={...t,headers:n};let c=!0;try{const s=typeof a.body=="string"?a.body:"";s&&s.length>6e4&&(c=!1)}catch{}const u=String(a.method||"GET").toUpperCase()==="GET"?15e3:2e4,d=new AbortController,h=setTimeout(()=>d.abort(),u);try{const s=await fetch(`${r}${e}`,{...a,keepalive:c,mode:"cors",cache:"no-store",signal:d.signal});if(clearTimeout(h),!s.ok){const y=await s.json().catch(()=>({}));throw new Error(y.error||`Request failed: ${s.status}`)}return s.json()}catch(s){clearTimeout(h);const y=s?.name==="AbortError"?"Network timeout. Please try again.":s?.message||"Network error";throw new Error(y)}}const l={async register(e,t,r,n){return o("/auth/register",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,phone:n})})},async registerBegin(e,t,r,n){return o("/auth/register/begin",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,phone:n})})},async registerVerify(e,t,r,n,a){return o("/auth/register/verify-otp",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,otp:n,phone:a})})},async policeRegister(e,t,r,n){return o("/police/register",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,station:n})})},async policeLogin(e,t,r){return o("/police/login",{method:"POST",body:JSON.stringify({email:e,password:t,station:r})})},async login(e,t){return o("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})})},async loginBegin(e,t){return o("/auth/login/begin",{method:"POST",body:JSON.stringify({email:e,password:t})})},async loginVerify(e,t){return o("/auth/login/verify-otp",{method:"POST",body:JSON.stringify({email:e,otp:t})})},async otpResend(e,t){return o("/auth/otp/resend",{method:"POST",body:JSON.stringify({email:e,purpose:t})})},async profile(e){return o("/profile",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async updateProfile(e,t){return o("/profile",{method:"PUT",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify(t)})},async changePassword(e,t,r){return o("/auth/change-password",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({currentPassword:t,newPassword:r})})},async deleteAccount(e,t){return o("/profile",{method:"DELETE",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({password:t})})}},m={async faqsList(e,t){const r=new URLSearchParams;return e&&r.set("q",e),t&&r.set("category",t),o(`/faqs?${r.toString()}`,{method:"GET"})},async faqVote(e,t,r){return o(`/faqs/${t}/vote`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({helpful:r})})},async faqVotes(e){return o("/faqs/votes",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async createTicket(e,t){return o("/support-tickets",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify(t)})},async listTickets(e){return o("/support-tickets",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async chatList(e){return o("/chat/messages",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async chatSend(e,t,r=!0){return o("/chat/send",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({message:t,useAI:r})})},async feedbackSubmit(e){return o("/feedback",{method:"POST",body:JSON.stringify(e)})},async feedbackStats(){return o("/feedback/stats",{method:"GET"})},async feedbackList(){return o("/feedback",{method:"GET"})},async supportContact(e){const t=new URLSearchParams;return e&&t.set("city",e),o(`/support/contact?${t.toString()}`,{method:"GET"})}};export{l as a,o as r,m as s};
