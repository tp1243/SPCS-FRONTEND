import{r as s,j as e}from"./charts-FoNSDMOs.js";import{v as U,w as K,x as _}from"./index-D8KJrxB-.js";import{B as W}from"./BrandIcon-CHAwuYok.js";import{L as A}from"./index-C2nar-Ha.js";import{E as X,b as Y,G as q,y as z}from"./index-BMC4Z6Sv.js";import{a as w}from"./api-CQIUfn0V.js";import{A as J,m as l}from"./motion-B__JDtHc.js";function L(){try{const n=typeof window<"u"?(localStorage.getItem("apiResolved")||localStorage.getItem("apiBaseOverride")||"").trim():"",r="".trim();let a=n||r||(typeof window<"u"?`${window.location.origin}/api`:"/api");return a=a.replace(/\/$/,""),a.endsWith("/api")?a:`${a}/api`}catch{return"/api"}}function ne(){const[n,r]=s.useState({google:!0,github:!0,apple:!1}),[o,a]=s.useState(!0);s.useEffect(()=>{(async()=>{a(!0);try{const g=L(),d=await fetch(`${g}/oauth/providers`).then(y=>y.json());r({google:!!d.google,github:!!d.github,apple:!!d.apple})}catch{r({google:!1,github:!1,apple:!1})}finally{a(!1)}})()},[]);const c=g=>{const d=L();window.location.href=`${d}/auth/${g}`};return e.jsxs("div",{className:"social-auth",children:[e.jsx("div",{className:"divider",children:e.jsx("span",{children:"OR"})}),e.jsxs("div",{className:`social-buttons ${o?"loading":""}`,children:[e.jsxs("button",{className:"btn social google","aria-label":"Continue with Google","data-provider":"google",disabled:!n.google,onClick:()=>c("google"),children:[e.jsx(U,{})," ",e.jsx("span",{className:"provider-label",children:"Continue with Google"})]}),e.jsxs("button",{className:"btn social github","aria-label":"Continue with GitHub","data-provider":"github",disabled:!n.github,onClick:()=>c("github"),children:[e.jsx(K,{})," ",e.jsx("span",{className:"provider-label",children:"Continue with GitHub"})]}),e.jsxs("button",{className:"btn social apple","aria-label":"Continue with Apple","data-provider":"apple",disabled:!n.apple,onClick:()=>c("apple"),title:n.apple?"":"Apple Sign In not configured",children:[e.jsx(_,{})," ",e.jsx("span",{className:"provider-label",children:"Continue with Apple"})]})]})]})}function re({variant:n}){const[r,o]=s.useState(!1);s.useEffect(()=>{const c=()=>o(window.scrollY>8);return c(),window.addEventListener("scroll",c),()=>window.removeEventListener("scroll",c)},[]);const a=n==="login";return e.jsx("header",{className:`auth-navbar ${r?"scrolled":""}`,children:e.jsxs("div",{className:"auth-nav-inner",children:[e.jsxs(A,{to:"/",className:"logo","aria-label":"Smart Police Complaint System (SPCS)",children:[e.jsx(W,{height:26,className:"logo-icon",title:"SPCS logo"}),e.jsx("span",{className:"logo-text",children:"SPCS"})]}),e.jsx("div",{className:"auth-nav-actions",children:a?e.jsx(A,{className:"btn primary",to:"/register",children:"Register"}):e.jsx(A,{className:"btn ghost",to:"/login",children:"Login"})})]})})}function le({open:n,purpose:r,email:o,beginPayload:a,onClose:c,onSuccess:g}){const[d,y]=s.useState(""),[N,m]=s.useState(!1),[T,p]=s.useState(""),[v,C]=s.useState(0),[I,k]=s.useState(300),b=s.useRef(null),u=s.useRef(null),[S,R]=s.useState(["","","","","",""]),f=s.useRef([]);s.useEffect(()=>{if(n)return p(""),y(""),C(0),k(300),R(["","","","","",""]),(async()=>{try{m(!0),r==="register"?await w.registerBegin(String(a?.username||""),o,String(a?.password||""),a?.phone):await w.loginBegin(o,String(a?.password||"")),O()}catch(t){p(t?.message||"Failed to send OTP")}finally{m(!1)}})(),()=>{b.current&&window.clearInterval(b.current),u.current&&window.clearInterval(u.current)}},[n]);function O(){b.current&&window.clearInterval(b.current),u.current&&window.clearInterval(u.current),k(300),b.current=window.setInterval(()=>{k(t=>t>0?t-1:0)},1e3)}function D(t,i){const x=i.replace(/\D/g,"").slice(0,1),h=[...S];h[t]=x,R(h);const E=h.join("");y(E),x&&t<5&&f.current[t+1]?.focus()}function $(t,i){i.key==="Backspace"&&!S[t]&&t>0&&f.current[t-1]?.focus(),i.key==="ArrowLeft"&&t>0&&(i.preventDefault(),f.current[t-1]?.focus()),i.key==="ArrowRight"&&t<5&&(i.preventDefault(),f.current[t+1]?.focus()),i.key==="Enter"&&P()}function M(t,i){const x=i.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(!x)return;i.preventDefault();const h=[...S];for(let j=0;j<6&&t+j<6;j++)h[t+j]=x[j]||"";R(h);const E=h.join("");y(E);const H=Math.min(5,t+x.length);f.current[H]?.focus()}async function P(){if(p(""),!d||d.trim().length!==6){p("Enter the 6-digit OTP");return}try{if(m(!0),r==="register"){const t=await w.registerVerify(String(a?.username||""),o,String(a?.password||""),d.trim(),a?.phone);g(t)}else{const t=await w.loginVerify(o,d.trim());g(t)}}catch(t){p(t?.message||"Invalid OTP")}finally{m(!1)}}async function B(){if(p(""),!(v>0))try{m(!0),await w.otpResend(o,r),C(60),u.current&&window.clearInterval(u.current),u.current=window.setInterval(()=>{C(t=>t>0?t-1:0)},1e3),O()}catch(t){p(t?.message||"Failed to resend OTP")}finally{m(!1)}}const F=r==="register"?"Verify your email":"Verify login",G=r==="register"?"Enter the 6-digit OTP sent to your email":"Enter the 6-digit OTP sent to your registered email",V=Math.max(0,Math.min(100,Math.floor(I/300*100)));return e.jsx(J,{children:n&&e.jsx(l.div,{className:"biometric-modal",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{backdropFilter:"blur(8px)",background:"radial-gradient(1200px 600px at 20% -10%, rgba(32,99,248,0.18), transparent), radial-gradient(1200px 600px at 120% 110%, rgba(255,129,64,0.18), transparent)"},children:e.jsxs(l.div,{className:"biometric-card",initial:{opacity:0,y:22,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.98},transition:{type:"spring",stiffness:260,damping:24},style:{boxShadow:"0 12px 40px rgba(0,0,0,0.2)",borderRadius:16,overflow:"hidden",border:"1px solid rgba(255,255,255,0.08)",background:"linear-gradient(180deg, rgba(20,22,26,0.9), rgba(20,22,26,0.85))"},children:[e.jsxs("div",{className:"biometric-header",children:[e.jsxs(l.div,{className:"brand-mini",initial:{opacity:0,x:-6},animate:{opacity:1,x:0},transition:{delay:.05},children:[e.jsx(l.div,{initial:{rotate:-8,scale:.9},animate:{rotate:0,scale:1},transition:{type:"spring",stiffness:320,damping:18},style:{display:"grid",placeItems:"center"},children:e.jsx(X,{})}),e.jsxs("div",{children:[e.jsx("div",{className:"brand-title",children:"SPCS"}),e.jsx("div",{className:"brand-sub",children:"Smart Police Complaint System"})]})]}),e.jsx("button",{className:"close-btn",onClick:c,"aria-label":"Close",children:e.jsx(Y,{})})]}),e.jsxs("div",{className:"biometric-body",children:[e.jsx("div",{className:"scan-left",children:e.jsxs(l.div,{className:"otp-card",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.08},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(q,{}),e.jsx("h4",{style:{margin:0},children:F})]}),e.jsx("div",{className:"muted",children:G}),e.jsx("div",{className:"otp-grid",style:{marginTop:14},children:[0,1,2,3,4,5].map(t=>e.jsx(l.input,{ref:i=>{f.current[t]=i},className:"otp-cell",inputMode:"numeric",maxLength:1,value:S[t],onChange:i=>D(t,i.target.value),onKeyDown:i=>$(t,i),onPaste:i=>M(t,i),whileFocus:{scale:1.04,boxShadow:"0 0 0 3px rgba(99,102,241,0.35)"},transition:{type:"spring",stiffness:380,damping:22}},t))}),T&&e.jsx("div",{className:"form-error small",children:T}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:12},children:[e.jsx(l.button,{className:"btn primary",onClick:P,disabled:N||I===0,whileTap:{scale:.98},children:N?"Verifying...":"Verify"}),e.jsxs(l.button,{className:"btn ghost",onClick:B,disabled:N||v>0,whileTap:{scale:.98},children:["Resend ",v>0?`(${v}s)`:""]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:10},children:[e.jsx(z,{})," Expires in ",Math.max(0,I),"s"]}),e.jsx("div",{style:{marginTop:8,width:"100%",height:6,background:"rgba(255,255,255,0.08)",borderRadius:999},children:e.jsx(l.div,{style:{height:6,borderRadius:999,background:"linear-gradient(90deg, #6366F1, #22D3EE)"},initial:{width:"100%"},animate:{width:`${V}%`},transition:{ease:"easeOut",duration:.25}})})]})}),e.jsxs("div",{className:"scan-right",children:[e.jsx(l.h3,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:.12},children:F}),e.jsx(l.p,{className:"muted",initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:.18},children:"One-time password verification with secure delivery"}),e.jsxs("ul",{className:"scan-steps",children:[e.jsx("li",{children:"Check inbox"}),e.jsx("li",{children:"Enter OTP"}),e.jsx("li",{children:"Complete verification"})]}),e.jsx("div",{className:"actions",children:e.jsx(l.button,{className:"btn ghost",onClick:c,whileTap:{scale:.98},children:"Cancel"})})]})]})]})})})}export{re as A,le as O,ne as S};
