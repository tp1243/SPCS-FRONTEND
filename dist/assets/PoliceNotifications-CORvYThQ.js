import{r as n,j as e}from"./charts-FoNSDMOs.js";import{f as S,o as k,p as N,d as I,b as F}from"./index-BMC4Z6Sv.js";import{p as c}from"./PoliceDashboard-B7L77VRw.js";import{c as A}from"./NotificationToast-vdJ0o7ky.js";import{u as R}from"./useNotificationSound-Cx2IYJLs.js";/* empty css                      */import"./react-BzrpNAyj.js";import"./icons-CvT1UHUk.js";import"./pdf-DU8byqIM.js";import"./BrandIcon-CHAwuYok.js";import"./api-_K8V4R3t.js";import"./index-CtVXpgqv.js";function T({token:i}){const[h,l]=n.useState([]),[v,o]=n.useState(!0),[p,u]=n.useState(null),[f,x]=n.useState("all"),[d,j]=n.useState(""),m=R({volume:.85,cooldownMs:0});n.useEffect(()=>{let t=!0;try{m.setEnabled(!0),m.prime()}catch{}const a=A("police",i);a.on("police:new_complaint",s=>{l(w=>[{_id:String(Date.now()),message:s.message,read:!1,createdAt:s.createdAt||new Date().toISOString(),complaintId:s.complaintId||void 0,station:""},...w]),m.play()}),(async()=>{try{const s=await c.listNotifications(i);t&&l(s.notifications);try{a.connect()}catch{}}catch{}finally{t&&o(!1)}})();const r=setInterval(()=>{c.listNotifications(i).then(s=>l(s.notifications)).catch(()=>{})},1e4);return()=>{t=!1,clearInterval(r),a.disconnect()}},[i,m]);const y=h.filter(t=>!t.read).length;async function C(t){try{const a=await c.markNotificationRead(i,t);l(r=>r.map(s=>s._id===t?a.notification:s))}catch(a){u(a.message||"Failed to mark as read")}}async function b(){try{const t=await c.markAllNotificationsRead(i);l(t.notifications)}catch(t){u(t.message||"Failed to clear notifications")}}const g=h.filter(t=>{const a=f==="all"?!0:!t.read,r=d.trim()===""?!0:t.message.toLowerCase().includes(d.trim().toLowerCase());return a&&r});return e.jsxs("div",{className:"panel",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:6},children:[e.jsx(S,{})," Notifications & Updates"]}),e.jsxs("span",{className:"badge",title:"Unread count",children:[y," Unread"]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("button",{className:"btn ghost",onClick:()=>{o(!0),c.listNotifications(i).then(t=>{l(t.notifications),o(!1)}).catch(()=>o(!1))},children:[e.jsx(k,{})," Refresh"]}),e.jsxs("button",{className:"btn",onClick:b,children:[e.jsx(N,{})," Mark all read"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",marginBottom:12},children:[e.jsxs("div",{className:"search modern","aria-label":"Search notifications",style:{flex:1},children:[e.jsx(I,{}),e.jsx("input",{value:d,onChange:t=>j(t.target.value),placeholder:"Search updates"}),d&&e.jsx("button",{className:"clear-btn",onClick:()=>j(""),title:"Clear",children:e.jsx(F,{})})]}),e.jsxs("div",{className:"filters",style:{display:"flex",gap:8},children:[e.jsx("span",{className:`pill ${f==="all"?"active":""}`,onClick:()=>x("all"),children:"All"}),e.jsx("span",{className:`pill ${f==="unread"?"active":""}`,onClick:()=>x("unread"),children:"Unread"})]})]}),p&&e.jsx("div",{className:"form-error",children:p}),v?e.jsx("div",{className:"muted",children:"Loading notificationsâ€¦"}):e.jsxs("div",{className:"notif-list",children:[g.map(t=>e.jsxs("div",{className:`notif-item ${t.read?"":"unread"}`,children:[e.jsxs("div",{className:"left",children:[e.jsx("div",{className:"title",children:"UPDATE"}),e.jsx("div",{children:t.message}),e.jsx("div",{className:"meta",children:new Date(t.createdAt||"").toLocaleString()})]}),e.jsx("div",{className:"right",children:!t.read&&e.jsxs("button",{className:"btn sm",onClick:()=>C(t._id),children:[e.jsx(N,{})," Mark read"]})})]},t._id)),g.length===0&&e.jsx("div",{className:"muted",children:"No notifications to show."})]})]})}export{T as default};
