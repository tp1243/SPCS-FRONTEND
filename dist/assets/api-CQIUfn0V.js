let i=null;function f(e){const t=e.trim();if(!t)return"";const r=t.replace(/\/$/,"");return r.endsWith("/api")?r:`${r}/api`}async function g(){if(i)return i;{const t=typeof window<"u"&&localStorage.getItem("apiBaseOverride")||""||(typeof window<"u"?window.location.origin:"http://localhost:5175");i=f(t)}return typeof window<"u"&&localStorage.setItem("apiResolved",i),i}async function o(e,t){const r=await g(),a={"Content-Type":"application/json",...t.headers||{}},s={...t,headers:a};let d=!0;try{const n=typeof s.body=="string"?s.body:"";n&&n.length>6e4&&(d=!1)}catch{}const y=String(s.method||"GET").toUpperCase()==="GET"?15e3:2e4,h=new AbortController,u=setTimeout(()=>h.abort(),y);try{const n=await fetch(`${r}${e}`,{...s,keepalive:d,mode:"cors",cache:"no-store",signal:h.signal});if(clearTimeout(u),!n.ok){const c=await n.json().catch(()=>({}));throw new Error(c.error||`Request failed: ${n.status}`)}return n.json()}catch(n){clearTimeout(u);const c=n?.name==="AbortError"?"Network timeout. Please try again.":n?.message||"Network error";throw new Error(c)}}const l={async register(e,t,r,a){return o("/auth/register",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,phone:a})})},async registerBegin(e,t,r,a){return o("/auth/register/begin",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,phone:a})})},async registerVerify(e,t,r,a,s){return o("/auth/register/verify-otp",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,otp:a,phone:s})})},async policeRegister(e,t,r,a){return o("/police/register",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,station:a})})},async policeLogin(e,t,r){return o("/police/login",{method:"POST",body:JSON.stringify({email:e,password:t,station:r})})},async login(e,t){return o("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})})},async loginBegin(e,t){return o("/auth/login/begin",{method:"POST",body:JSON.stringify({email:e,password:t})})},async loginVerify(e,t){return o("/auth/login/verify-otp",{method:"POST",body:JSON.stringify({email:e,otp:t})})},async otpResend(e,t){return o("/auth/otp/resend",{method:"POST",body:JSON.stringify({email:e,purpose:t})})},async profile(e){return o("/profile",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async updateProfile(e,t){return o("/profile",{method:"PUT",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify(t)})},async changePassword(e,t,r){return o("/auth/change-password",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({currentPassword:t,newPassword:r})})},async deleteAccount(e,t){return o("/profile",{method:"DELETE",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({password:t})})}},p={async faqsList(e,t){const r=new URLSearchParams;return e&&r.set("q",e),t&&r.set("category",t),o(`/faqs?${r.toString()}`,{method:"GET"})},async faqVote(e,t,r){return o(`/faqs/${t}/vote`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({helpful:r})})},async faqVotes(e){return o("/faqs/votes",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async createTicket(e,t){return o("/support-tickets",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify(t)})},async listTickets(e){return o("/support-tickets",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async chatList(e){return o("/chat/messages",{method:"GET",headers:{Authorization:`Bearer ${e}`}})},async chatSend(e,t,r=!0){return o("/chat/send",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({message:t,useAI:r})})},async feedbackSubmit(e){return o("/feedback",{method:"POST",body:JSON.stringify(e)})},async feedbackStats(){return o("/feedback/stats",{method:"GET"})},async feedbackList(){return o("/feedback",{method:"GET"})},async supportContact(e){const t=new URLSearchParams;return e&&t.set("city",e),o(`/support/contact?${t.toString()}`,{method:"GET"})}};export{l as a,o as r,p as s};
