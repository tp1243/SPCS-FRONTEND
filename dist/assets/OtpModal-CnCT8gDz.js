import{r as a,j as e}from"./charts-FoNSDMOs.js";import{v as K,w as U,x as X}from"./index-D8KJrxB-.js";import{B as Y}from"./BrandIcon-CHAwuYok.js";import{L as T}from"./index-CtVXpgqv.js";import{E as _,b as q,G as z,y as J}from"./index-BMC4Z6Sv.js";import{a as j}from"./api-_K8V4R3t.js";import{A as Q,m as n}from"./motion-B__JDtHc.js";const L="http://localhost:5175/api";function ne(){const[r,l]=a.useState({google:!0,github:!0,apple:!1}),[c,s]=a.useState(!0);a.useEffect(()=>{(async()=>{s(!0);try{const d=await fetch(`${L}/oauth/providers`).then(g=>g.json());l({google:!!d.google,github:!!d.github,apple:!!d.apple})}catch{l({google:!0,github:!0,apple:!1})}finally{s(!1)}})()},[]);const o=d=>{window.location.href=`${L}/auth/${d}`};return e.jsxs("div",{className:"social-auth",children:[e.jsx("div",{className:"divider",children:e.jsx("span",{children:"OR"})}),e.jsxs("div",{className:`social-buttons ${c?"loading":""}`,children:[e.jsxs("button",{className:"btn social google","aria-label":"Continue with Google","data-provider":"google",disabled:!r.google,onClick:()=>o("google"),children:[e.jsx(K,{})," ",e.jsx("span",{className:"provider-label",children:"Continue with Google"})]}),e.jsxs("button",{className:"btn social github","aria-label":"Continue with GitHub","data-provider":"github",disabled:!r.github,onClick:()=>o("github"),children:[e.jsx(U,{})," ",e.jsx("span",{className:"provider-label",children:"Continue with GitHub"})]}),e.jsxs("button",{className:"btn social apple","aria-label":"Continue with Apple","data-provider":"apple",disabled:!r.apple,onClick:()=>o("apple"),title:r.apple?"":"Apple Sign In not configured",children:[e.jsx(X,{})," ",e.jsx("span",{className:"provider-label",children:"Continue with Apple"})]})]})]})}function re({variant:r}){const[l,c]=a.useState(!1);a.useEffect(()=>{const o=()=>c(window.scrollY>8);return o(),window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[]);const s=r==="login";return e.jsx("header",{className:`auth-navbar ${l?"scrolled":""}`,children:e.jsxs("div",{className:"auth-nav-inner",children:[e.jsxs(T,{to:"/",className:"logo","aria-label":"Smart Police Complaint System (SPCS)",children:[e.jsx(Y,{height:26,className:"logo-icon",title:"SPCS logo"}),e.jsx("span",{className:"logo-text",children:"SPCS"})]}),e.jsx("div",{className:"auth-nav-actions",children:s?e.jsx(T,{className:"btn primary",to:"/register",children:"Register"}):e.jsx(T,{className:"btn ghost",to:"/login",children:"Login"})})]})})}function le({open:r,purpose:l,email:c,beginPayload:s,onClose:o,onSuccess:d}){const[g,N]=a.useState(""),[S,m]=a.useState(!1),[A,u]=a.useState(""),[v,C]=a.useState(0),[k,E]=a.useState(300),y=a.useRef(null),h=a.useRef(null),[w,I]=a.useState(["","","","","",""]),f=a.useRef([]);a.useEffect(()=>{if(r)return u(""),N(""),C(0),E(300),I(["","","","","",""]),(async()=>{try{m(!0),l==="register"?await j.registerBegin(String(s?.username||""),c,String(s?.password||""),s?.phone):await j.loginBegin(c,String(s?.password||"")),O()}catch(t){u(t?.message||"Failed to send OTP")}finally{m(!1)}})(),()=>{y.current&&window.clearInterval(y.current),h.current&&window.clearInterval(h.current)}},[r]);function O(){y.current&&window.clearInterval(y.current),h.current&&window.clearInterval(h.current),E(300),y.current=window.setInterval(()=>{E(t=>t>0?t-1:0)},1e3)}function D(t,i){const x=i.replace(/\D/g,"").slice(0,1),p=[...w];p[t]=x,I(p);const R=p.join("");N(R),x&&t<5&&f.current[t+1]?.focus()}function M(t,i){i.key==="Backspace"&&!w[t]&&t>0&&f.current[t-1]?.focus(),i.key==="ArrowLeft"&&t>0&&(i.preventDefault(),f.current[t-1]?.focus()),i.key==="ArrowRight"&&t<5&&(i.preventDefault(),f.current[t+1]?.focus()),i.key==="Enter"&&F()}function G(t,i){const x=i.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(!x)return;i.preventDefault();const p=[...w];for(let b=0;b<6&&t+b<6;b++)p[t+b]=x[b]||"";I(p);const R=p.join("");N(R);const H=Math.min(5,t+x.length);f.current[H]?.focus()}async function F(){if(u(""),!g||g.trim().length!==6){u("Enter the 6-digit OTP");return}try{if(m(!0),l==="register"){const t=await j.registerVerify(String(s?.username||""),c,String(s?.password||""),g.trim(),s?.phone);d(t)}else{const t=await j.loginVerify(c,g.trim());d(t)}}catch(t){u(t?.message||"Invalid OTP")}finally{m(!1)}}async function V(){if(u(""),!(v>0))try{m(!0),await j.otpResend(c,l),C(60),h.current&&window.clearInterval(h.current),h.current=window.setInterval(()=>{C(t=>t>0?t-1:0)},1e3),O()}catch(t){u(t?.message||"Failed to resend OTP")}finally{m(!1)}}const P=l==="register"?"Verify your email":"Verify login",$=l==="register"?"Enter the 6-digit OTP sent to your email":"Enter the 6-digit OTP sent to your registered email",B=Math.max(0,Math.min(100,Math.floor(k/300*100)));return e.jsx(Q,{children:r&&e.jsx(n.div,{className:"biometric-modal",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{backdropFilter:"blur(8px)",background:"radial-gradient(1200px 600px at 20% -10%, rgba(32,99,248,0.18), transparent), radial-gradient(1200px 600px at 120% 110%, rgba(255,129,64,0.18), transparent)"},children:e.jsxs(n.div,{className:"biometric-card",initial:{opacity:0,y:22,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.98},transition:{type:"spring",stiffness:260,damping:24},style:{boxShadow:"0 12px 40px rgba(0,0,0,0.2)",borderRadius:16,overflow:"hidden",border:"1px solid rgba(255,255,255,0.08)",background:"linear-gradient(180deg, rgba(20,22,26,0.9), rgba(20,22,26,0.85))"},children:[e.jsxs("div",{className:"biometric-header",children:[e.jsxs(n.div,{className:"brand-mini",initial:{opacity:0,x:-6},animate:{opacity:1,x:0},transition:{delay:.05},children:[e.jsx(n.div,{initial:{rotate:-8,scale:.9},animate:{rotate:0,scale:1},transition:{type:"spring",stiffness:320,damping:18},style:{display:"grid",placeItems:"center"},children:e.jsx(_,{})}),e.jsxs("div",{children:[e.jsx("div",{className:"brand-title",children:"SPCS"}),e.jsx("div",{className:"brand-sub",children:"Smart Police Complaint System"})]})]}),e.jsx("button",{className:"close-btn",onClick:o,"aria-label":"Close",children:e.jsx(q,{})})]}),e.jsxs("div",{className:"biometric-body",children:[e.jsx("div",{className:"scan-left",children:e.jsxs(n.div,{className:"otp-card",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.08},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(z,{}),e.jsx("h4",{style:{margin:0},children:P})]}),e.jsx("div",{className:"muted",children:$}),e.jsx("div",{className:"otp-grid",style:{marginTop:14},children:[0,1,2,3,4,5].map(t=>e.jsx(n.input,{ref:i=>{f.current[t]=i},className:"otp-cell",inputMode:"numeric",maxLength:1,value:w[t],onChange:i=>D(t,i.target.value),onKeyDown:i=>M(t,i),onPaste:i=>G(t,i),whileFocus:{scale:1.04,boxShadow:"0 0 0 3px rgba(99,102,241,0.35)"},transition:{type:"spring",stiffness:380,damping:22}},t))}),A&&e.jsx("div",{className:"form-error small",children:A}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:12},children:[e.jsx(n.button,{className:"btn primary",onClick:F,disabled:S||k===0,whileTap:{scale:.98},children:S?"Verifying...":"Verify"}),e.jsxs(n.button,{className:"btn ghost",onClick:V,disabled:S||v>0,whileTap:{scale:.98},children:["Resend ",v>0?`(${v}s)`:""]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:10},children:[e.jsx(J,{})," Expires in ",Math.max(0,k),"s"]}),e.jsx("div",{style:{marginTop:8,width:"100%",height:6,background:"rgba(255,255,255,0.08)",borderRadius:999},children:e.jsx(n.div,{style:{height:6,borderRadius:999,background:"linear-gradient(90deg, #6366F1, #22D3EE)"},initial:{width:"100%"},animate:{width:`${B}%`},transition:{ease:"easeOut",duration:.25}})})]})}),e.jsxs("div",{className:"scan-right",children:[e.jsx(n.h3,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:.12},children:P}),e.jsx(n.p,{className:"muted",initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:.18},children:"One-time password verification with secure delivery"}),e.jsxs("ul",{className:"scan-steps",children:[e.jsx("li",{children:"Check inbox"}),e.jsx("li",{children:"Enter OTP"}),e.jsx("li",{children:"Complete verification"})]}),e.jsx("div",{className:"actions",children:e.jsx(n.button,{className:"btn ghost",onClick:o,whileTap:{scale:.98},children:"Cancel"})})]})]})]})})})}export{re as A,le as O,ne as S};
