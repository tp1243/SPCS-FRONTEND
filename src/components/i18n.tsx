
import { createContext, useContext, useEffect, useMemo, useState } from 'react'

type Lang = 'en' | 'hi' | 'mr'

type Dict = Record<string, string>

const dictionaries: Record<Lang, Dict> = {
  en: {
    welcome: 'Welcome, {username}!'
    ,search_placeholder: 'Search by title, ID, status'
    ,search_btn: 'Search'
    ,profile_view: 'View Profile'
    ,profile_edit: 'Edit Profile'
    ,settings: 'Settings'
    ,logout: 'Logout'
    ,no_updates: 'No updates'
    ,clear_all: 'Clear All'
    ,notifications_updates: 'Notifications & Updates'
    ,unread: 'Unread'
    ,refresh: 'Refresh'
    ,mark_all_read: 'Mark all read'
    ,notifications_loading: 'Loading notifications…'
    ,notifications_search_placeholder: 'Search updates'
    ,filter_all: 'All'
    ,filter_unread: 'Unread'
    ,overview_total: 'Total Complaints Filed'
    ,overview_solved: 'Complaints Solved'
    ,overview_pending: 'Pending Complaints'
    ,overview_review: 'Under Review'
    ,overview_quick: 'Quick actions: Use the sidebar to submit or track a complaint.'
    ,complaints_search_placeholder: 'Search complaints by ID, crime, or station'
    ,clear: 'Clear'
    ,table_id: 'ID'
    ,table_title: 'Title'
    ,table_date: 'Date'
    ,table_status: 'Status'
    ,table_station: 'Station'
    ,table_actions: 'Actions'
    ,no_complaints_yet: 'No complaints yet.'
    ,unassigned: 'Unassigned'
    ,download_pdf: 'Download PDF'
    ,form_title: 'Title'
    ,form_type: 'Type'
    ,form_select: 'Select…'
    ,crime_robbery: 'Robbery'
    ,crime_fraud: 'Fraud'
    ,crime_harassment: 'Harassment'
    ,crime_accident: 'Accident'
    ,crime_theft: 'Theft'
    ,crime_murder: 'Murder'
    ,form_description: 'Description'
    ,form_date: 'Date'
    ,form_time: 'Time'
    ,form_contact: 'Contact'
    ,form_location_address: 'Location Address'
    ,form_latitude: 'Latitude'
    ,form_longitude: 'Longitude'
    ,loc_status: 'Status'
    ,loc_accuracy: 'Accuracy ±'
    ,loc_updated: 'Updated'
    ,use_my_location: 'Use my location'
    ,upload_photo: 'Upload Photo'
    ,remove_photo: 'Remove photo'
    ,submit_btn: 'Submit'
    ,submitting: 'Submitting…'
    ,sending: 'Sending…'
    ,uploading_photo: 'Uploading photo…'
    ,finalizing: 'Finalizing…'
    ,no_notifications: 'No notifications to show.'
    ,mark_read: 'Mark read'
    ,sidebar_overview: 'Dashboard Overview'
    ,sidebar_new: 'Report New Complaint'
    ,sidebar_my: 'My Complaints'
    ,sidebar_track: 'Track Complaint (Map View)'
    ,sidebar_notifications: 'Notifications / Updates'
    ,sidebar_profile: 'Profile Settings'
    ,sidebar_support: 'Help & Support'
    ,sidebar_feedback: 'Feedback'
    ,logout_link: 'Logout'
    ,open_in_maps: 'Open in Maps'
    ,support_heading: 'Help & Support'
    ,tab_chat: 'Live Chat'
    ,tab_feedback: 'Feedback'
    ,chat_toggle_open: 'Open'
    ,type_message_placeholder: 'Type your message…'
    ,send_btn: 'Send'
    ,feedback_heading: 'Share Feedback'
    ,feedback_optional_label: 'Feedback (optional)'
    ,send_feedback: 'Send Feedback'
    ,recent_feedback: 'Recent Feedback'
    ,loading_dashboard: 'Loading dashboard…'
    ,loading_analytics: 'Loading analytics…'
    ,open_menu: 'Open menu'
    ,close_menu: 'Close menu'
    ,faqs: 'FAQs'
    ,support_intro: 'Find answers in FAQs, chat live, or share feedback.'
    ,view_details: 'View Details'
    ,close: 'Close'
    ,type: 'Type'
    ,description: 'Description'
    ,no_description: 'No description provided.'
    ,location: 'Location'
    ,routed_station: 'Routed Station'
    ,locating: 'Locating…'
    ,no_faqs: 'No FAQs found. Try different keywords.'
  },
  hi: {
    welcome: 'स्वागत है, {username}!'
    ,search_placeholder: 'शीर्षक, आईडी, स्थिति से खोजें'
    ,search_btn: 'खोजें'
    ,profile_view: 'प्रोफ़ाइल देखें'
    ,profile_edit: 'प्रोफ़ाइल संपादित करें'
    ,settings: 'सेटिंग्स'
    ,logout: 'लॉग आउट'
    ,no_updates: 'कोई अपडेट नहीं'
    ,clear_all: 'सब साफ करें'
    ,notifications_updates: 'सूचनाएँ और अपडेट'
    ,unread: 'अपठित'
    ,refresh: 'ताज़ा करें'
    ,mark_all_read: 'सबको पढ़ा चिह्नित करें'
    ,notifications_loading: 'सूचनाएँ लोड हो रही हैं…'
    ,notifications_search_placeholder: 'अपडेट खोजें'
    ,filter_all: 'सभी'
    ,filter_unread: 'अपठित'
    ,overview_total: 'कुल दर्ज शिकायतें'
    ,overview_solved: 'सुलझी शिकायतें'
    ,overview_pending: 'लंबित शिकायतें'
    ,overview_review: 'समीक्षा में'
    ,overview_quick: 'त्वरित क्रियाएँ: शिकायत दर्ज या ट्रैक करने के लिए साइडबार का उपयोग करें.'
    ,complaints_search_placeholder: 'आईडी, अपराध या थाने से शिकायतें खोजें'
    ,clear: 'हटाएँ'
    ,table_id: 'आईडी'
    ,table_title: 'शीर्षक'
    ,table_date: 'तिथि'
    ,table_status: 'स्थिति'
    ,table_station: 'थाना'
    ,table_actions: 'क्रियाएँ'
    ,no_complaints_yet: 'अभी कोई शिकायत नहीं.'
    ,unassigned: 'अनियोजित'
    ,download_pdf: 'पीडीएफ डाउनलोड करें'
    ,form_title: 'शीर्षक'
    ,form_type: 'प्रकार'
    ,form_select: 'चुनें…'
    ,crime_robbery: 'डकैती'
    ,crime_fraud: 'धोखाधड़ी'
    ,crime_harassment: 'उत्पीड़न'
    ,crime_accident: 'दुर्घटना'
    ,crime_theft: 'चोरी'
    ,crime_murder: 'हत्या'
    ,form_description: 'विवरण'
    ,form_date: 'तिथि'
    ,form_time: 'समय'
    ,form_contact: 'संपर्क'
    ,form_location_address: 'स्थान का पता'
    ,form_latitude: 'अक्षांश'
    ,form_longitude: 'देशांतर'
    ,loc_status: 'स्थिति'
    ,loc_accuracy: 'शुद्धता ±'
    ,loc_updated: 'अद्यतन'
    ,use_my_location: 'मेरा स्थान उपयोग करें'
    ,upload_photo: 'फोटो अपलोड करें'
    ,remove_photo: 'फोटो हटाएँ'
    ,submit_btn: 'जमा करें'
    ,submitting: 'जमा हो रहा है…'
    ,sending: 'भेजा जा रहा है…'
    ,uploading_photo: 'फोटो अपलोड हो रहा है…'
    ,finalizing: 'अंतिम रूप दिया जा रहा है…'
    ,no_notifications: 'दिखाने के लिए कोई सूचनाएँ नहीं.'
    ,mark_read: 'पढ़ा चिह्नित करें'
    ,sidebar_overview: 'डैशबोर्ड अवलोकन'
    ,sidebar_new: 'नई शिकायत दर्ज करें'
    ,sidebar_my: 'मेरी शिकायतें'
    ,sidebar_track: 'शिकायत ट्रैक करें (मानचित्र)'
    ,sidebar_notifications: 'सूचनाएँ / अपडेट'
    ,sidebar_profile: 'प्रोफ़ाइल सेटिंग्स'
    ,sidebar_support: 'मदद और सहायता'
    ,sidebar_feedback: 'प्रतिक्रिया'
    ,logout_link: 'लॉग आउट'
    ,open_in_maps: 'मैप्स में खोलें'
    ,support_heading: 'मदद और सहायता'
    ,tab_chat: 'लाइव चैट'
    ,tab_feedback: 'प्रतिक्रिया'
    ,chat_toggle_open: 'खोलें'
    ,type_message_placeholder: 'अपना संदेश लिखें…'
    ,send_btn: 'भेजें'
    ,feedback_heading: 'प्रतिक्रिया साझा करें'
    ,feedback_optional_label: 'प्रतिक्रिया (वैकल्पिक)'
    ,send_feedback: 'प्रतिक्रिया भेजें'
    ,recent_feedback: 'हाल की प्रतिक्रिया'
    ,loading_dashboard: 'डैशबोर्ड लोड हो रहा है…'
    ,loading_analytics: 'एनालिटिक्स लोड हो रहा है…'
    ,open_menu: 'मेन्यू खोलें'
    ,close_menu: 'मेन्यू बंद करें'
    ,faqs: 'अक्सर पूछे जाने वाले प्रश्न'
    ,support_intro: 'FAQ में उत्तर खोजें, लाइव चैट करें या प्रतिक्रिया साझा करें.'
    ,view_details: 'विवरण देखें'
    ,close: 'बंद करें'
    ,type: 'प्रकार'
    ,description: 'विवरण'
    ,no_description: 'कोई विवरण उपलब्ध नहीं.'
    ,location: 'स्थान'
    ,routed_station: 'निर्देशित थाना'
    ,locating: 'स्थान पता लगाया जा रहा है…'
    ,no_faqs: 'कोई FAQ नहीं मिला। अलग कीवर्ड आज़माएँ.'
  },
  mr: {
    welcome: 'स्वागत आहे, {username}!'
    ,search_placeholder: 'शीर्षक, आयडी, स्थितीनुसार शोधा'
    ,search_btn: 'शोधा'
    ,profile_view: 'प्रोफाइल पहा'
    ,profile_edit: 'प्रोफाइल संपादित करा'
    ,settings: 'सेटिंग्ज'
    ,logout: 'लॉग आऊट'
    ,no_updates: 'अपडेट नाहीत'
    ,clear_all: 'सर्व साफ करा'
    ,notifications_updates: 'सूचना आणि अपडेट्स'
    ,unread: 'न वाचलेले'
    ,refresh: 'रीफ्रेश'
    ,mark_all_read: 'सर्व वाचलेले चिन्हांकित करा'
    ,notifications_loading: 'सूचना लोड होत आहेत…'
    ,notifications_search_placeholder: 'अपडेट शोधा'
    ,filter_all: 'सर्व'
    ,filter_unread: 'न वाचलेले'
    ,overview_total: 'एकूण नोंदवलेल्या तक्रारी'
    ,overview_solved: 'निकाली तक्रारी'
    ,overview_pending: 'प्रलंबित तक्रारी'
    ,overview_review: 'पुनरावलोकनाधीन'
    ,overview_quick: 'त्वरित क्रिया: तक्रार नोंदवण्यासाठी किंवा ट्रॅक करण्यासाठी साइडबार वापरा.'
    ,complaints_search_placeholder: 'आयडी, गुन्हा किंवा पोलीस स्टेशननुसार तक्रारी शोधा'
    ,clear: 'क्लिअर'
    ,table_id: 'आयडी'
    ,table_title: 'शीर्षक'
    ,table_date: 'तारीख'
    ,table_status: 'स्थिती'
    ,table_station: 'पोलीस स्टेशन'
    ,table_actions: 'क्रिया'
    ,no_complaints_yet: 'अजून कोणतीही तक्रार नाही.'
    ,unassigned: 'न नेमलेले'
    ,download_pdf: 'पीडीएफ डाउनलोड'
    ,form_title: 'शीर्षक'
    ,form_type: 'प्रकार'
    ,form_select: 'निवडा…'
    ,crime_robbery: 'दरोडा'
    ,crime_fraud: 'फसवणूक'
    ,crime_harassment: 'छळ'
    ,crime_accident: 'अपघात'
    ,crime_theft: 'चोरी'
    ,crime_murder: 'हत्या'
    ,form_description: 'वर्णन'
    ,form_date: 'तारीख'
    ,form_time: 'वेळ'
    ,form_contact: 'संपर्क'
    ,form_location_address: 'स्थानाचा पत्ता'
    ,form_latitude: 'अक्षांश'
    ,form_longitude: 'रेखांश'
    ,loc_status: 'स्थिती'
    ,loc_accuracy: 'अचूकता ±'
    ,loc_updated: 'अद्यतनित'
    ,use_my_location: 'माझे स्थान वापरा'
    ,upload_photo: 'फोटो अपलोड'
    ,remove_photo: 'फोटो काढा'
    ,submit_btn: 'सबमिट'
    ,submitting: 'सबमिट होत आहे…'
    ,sending: 'पाठवित आहे…'
    ,uploading_photo: 'फोटो अपलोड होत आहे…'
    ,finalizing: 'अंतिम करत आहे…'
    ,no_notifications: 'दाखविण्यासाठी सूचना नाहीत.'
    ,mark_read: 'वाचलेले चिन्हांकित करा'
    ,sidebar_overview: 'डॅशबोर्ड आढावा'
    ,sidebar_new: 'नवीन तक्रार नोंदवा'
    ,sidebar_my: 'माझ्या तक्रारी'
    ,sidebar_track: 'तक्रार ट्रॅक करा (नकाशा)'
    ,sidebar_notifications: 'सूचना / अपडेट्स'
    ,sidebar_profile: 'प्रोफाइल सेटिंग्ज'
    ,sidebar_support: 'मदत आणि समर्थन'
    ,sidebar_feedback: 'अभिप्राय'
    ,logout_link: 'लॉग आऊट'
    ,open_in_maps: 'नकाशात उघडा'
    ,support_heading: 'मदत आणि समर्थन'
    ,tab_chat: 'लाईव्ह चॅट'
    ,tab_feedback: 'अभिप्राय'
    ,chat_toggle_open: 'उघडा'
    ,type_message_placeholder: 'तुमचा संदेश लिहा…'
    ,send_btn: 'पाठवा'
    ,feedback_heading: 'अभिप्राय शेअर करा'
    ,feedback_optional_label: 'अभिप्राय (पर्यायी)'
    ,send_feedback: 'अभिप्राय पाठवा'
    ,recent_feedback: 'अलीकडचा अभिप्राय'
    ,loading_dashboard: 'डॅशबोर्ड लोड होत आहे…'
    ,loading_analytics: 'एनालिटिक्स लोड होत आहे…'
    ,open_menu: 'मेनू उघडा'
    ,close_menu: 'मेनू बंद करा'
    ,faqs: 'वारंवार विचारले जाणारे प्रश्न'
    ,support_intro: 'FAQ मध्ये उत्तर शोधा, लाईव्ह चॅट करा किंवा अभिप्राय शेअर करा.'
    ,view_details: 'तपशील पहा'
    ,close: 'बंद करा'
    ,type: 'प्रकार'
    ,description: 'वर्णन'
    ,no_description: 'वर्णन उपलब्ध नाही.'
    ,location: 'स्थान'
    ,routed_station: 'मार्गित स्टेशन'
    ,locating: 'स्थान शोधत आहे…'
    ,no_faqs: 'FAQ सापडले नाहीत. वेगळे कीवर्ड वापरून पहा.'
  },
}

type Ctx = {
  lang: Lang
  setLanguage: (l: Lang) => void
  t: (key: string, params?: Record<string, string | number>) => string
}

const I18nContext = createContext<Ctx | null>(null)

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLang] = useState<Lang>(() => (localStorage.getItem('lang') as Lang) || 'en')
  useEffect(() => { try { localStorage.setItem('lang', lang) } catch {} }, [lang])
  const t = useMemo(() => {
    return (key: string, params?: Record<string, string | number>) => {
      const dict = dictionaries[lang] || dictionaries.en
      let v = dict[key] || dictionaries.en[key] || key
      if (params) {
        for (const [k, val] of Object.entries(params)) {
          v = v.replace(new RegExp(`\\{${k}\\}`, 'g'), String(val))
        }
      }
      return v
    }
  }, [lang])
  const ctx: Ctx = { lang, setLanguage: (l) => setLang(l), t }
  return <I18nContext.Provider value={ctx}>{children}</I18nContext.Provider>
}

export function useI18n() {
  const ctx = useContext(I18nContext)
  if (!ctx) throw new Error('useI18n must be used within I18nProvider')
  return ctx
}

